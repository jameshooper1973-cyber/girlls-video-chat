<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Girls' Video Chat üíñ</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>body { margin: 0; padding: 0; }</style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useRef, useEffect } = React;
        const Video = ({ size = 24 }) => (<svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M23 7l-7 5 7 5V7z"/><rect x="1" y="5" width="15" height="14" rx="2" ry="2"/></svg>);
        const VideoOff = ({ size = 24 }) => (<svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M16 16v1a2 2 0 01-2 2H3a2 2 0 01-2-2V7a2 2 0 012-2h2m5.66 0H14a2 2 0 012 2v3.34l1 1L23 7v10"/><line x1="1" y1="1" x2="23" y2="23"/></svg>);
        const Mic = ({ size = 24 }) => (<svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M12 1a3 3 0 00-3 3v8a3 3 0 006 0V4a3 3 0 00-3-3z"/><path d="M19 10v2a7 7 0 01-14 0v-2"/><line x1="12" y1="19" x2="12" y2="23"/><line x1="8" y1="23" x2="16" y2="23"/></svg>);
        const MicOff = ({ size = 24 }) => (<svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="1" y1="1" x2="23" y2="23"/><path d="M9 9v3a3 3 0 005.12 2.12M15 9.34V4a3 3 0 00-5.94-.6"/><path d="M17 16.95A7 7 0 015 12v-2m14 0v2a7 7 0 01-.11 1.23"/><line x1="12" y1="19" x2="12" y2="23"/><line x1="8" y1="23" x2="16" y2="23"/></svg>);
        const Phone = ({ size = 24 }) => (<svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M22 16.92v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07 19.5 19.5 0 01-6-6 19.79 19.79 0 01-3.07-8.67A2 2 0 014.11 2h3a2 2 0 012 1.72 12.84 12.84 0 00.7 2.81 2 2 0 01-.45 2.11L8.09 9.91a16 16 0 006 6l1.27-1.27a2 2 0 012.11-.45 12.84 12.84 0 002.81.7A2 2 0 0122 16.92z"/></svg>);
        const PhoneOff = ({ size = 24 }) => (<svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M10.68 13.31a16 16 0 003.41 2.6l1.27-1.27a2 2 0 012.11-.45 12.84 12.84 0 002.81.7 2 2 0 011.72 2v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07 19.42 19.42 0 01-3.33-2.67m-2.67-3.34a19.79 19.79 0 01-3.07-8.63A2 2 0 014.11 2h3a2 2 0 012 1.72 12.84 12.84 0 00.7 2.81 2 2 0 01-.45 2.11L8.09 9.91"/><line x1="23" y1="1" x2="1" y2="23"/></svg>);
        const Send = ({ size = 24 }) => (<svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>);
        const Copy = ({ size = 24 }) => (<svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg>);
        const MessageCircle = ({ size = 24 }) => (<svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 11.5a8.38 8.38 0 01-.9 3.8 8.5 8.5 0 01-7.6 4.7 8.38 8.38 0 01-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 01-.9-3.8 8.5 8.5 0 014.7-7.6 8.38 8.38 0 013.8-.9h.5a8.48 8.48 0 018 8v.5z"/></svg>);
        const X = ({ size = 24 }) => (<svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>);
        
        function GirlyVideoChat() {
          const [localStream, setLocalStream] = useState(null);
          const [isVideoOn, setIsVideoOn] = useState(true);
          const [isAudioOn, setIsAudioOn] = useState(true);
          const [isInCall, setIsInCall] = useState(false);
          const [roomCode, setRoomCode] = useState('');
          const [myRoomCode, setMyRoomCode] = useState('');
          const [username, setUsername] = useState('');
          const [showJoinRoom, setShowJoinRoom] = useState(false);
          const [messages, setMessages] = useState([]);
          const [messageInput, setMessageInput] = useState('');
          const [showChat, setShowChat] = useState(false);
          const [unreadMessages, setUnreadMessages] = useState(0);
          const [peerId, setPeerId] = useState(null);
          const [peer, setPeer] = useState(null);
          const [call, setCall] = useState(null);
          const [connectionStatus, setConnectionStatus] = useState('disconnected');
          const localVideoRef = useRef(null);
          const remoteVideoRef = useRef(null);
          const messagesEndRef = useRef(null);
          const dataConnectionRef = useRef(null);

          useEffect(() => {
            const newPeer = new Peer({
              config: { iceServers: [{ urls: 'stun:stun.l.google.com:19302' }, { urls: 'stun:stun1.l.google.com:19302' }] }
            });
            newPeer.on('open', (id) => { setPeerId(id); console.log('My peer ID:', id); });
            newPeer.on('call', (incomingCall) => {
              if (localStream) {
                incomingCall.answer(localStream);
                setCall(incomingCall);
                setConnectionStatus('connected');
                incomingCall.on('stream', (remoteStream) => {
                  if (remoteVideoRef.current) remoteVideoRef.current.srcObject = remoteStream;
                });
              }
            });
            newPeer.on('connection', (conn) => {
              dataConnectionRef.current = conn;
              conn.on('data', (data) => {
                if (data.type === 'message') {
                  setMessages(prev => [...prev, { text: data.text, sender: 'friend', time: new Date() }]);
                  if (!showChat) setUnreadMessages(prev => prev + 1);
                }
              });
              conn.on('open', () => setConnectionStatus('connected'));
            });
            newPeer.on('error', (err) => { console.error('PeerJS error:', err); alert('Connection error. Please try again!'); });
            setPeer(newPeer);
            return () => { if (newPeer) newPeer.destroy(); };
          }, [localStream, showChat]);

          const startLocalStream = async () => {
            try {
              const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
              setLocalStream(stream);
              if (localVideoRef.current) localVideoRef.current.srcObject = stream;
            } catch (err) {
              alert('Please allow camera and microphone access!');
              console.error('Error accessing media devices:', err);
            }
          };

          useEffect(() => {
            startLocalStream();
            return () => { if (localStream) localStream.getTracks().forEach(track => track.stop()); };
          }, []);

          useEffect(() => { messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' }); }, [messages]);

          const createRoom = () => {
            if (!username.trim()) { alert('Please enter your name first! üíï'); return; }
            if (!peerId) { alert('Connecting... Please wait a moment! ‚ú®'); return; }
            const code = peerId.substring(0, 8).toUpperCase();
            setMyRoomCode(code);
            setIsInCall(true);
            setConnectionStatus('waiting');
          };

          const joinRoom = () => {
            if (!username.trim()) { alert('Please enter your name first! üíï'); return; }
            if (!roomCode.trim()) { alert('Please enter a room code! ‚ú®'); return; }
            if (!peerId || !localStream) { alert('Connecting... Please wait! üí´'); return; }
            setIsInCall(true);
            setConnectionStatus('connecting');
            const outgoingCall = peer.call(roomCode.toLowerCase(), localStream);
            setCall(outgoingCall);
            outgoingCall.on('stream', (remoteStream) => {
              if (remoteVideoRef.current) remoteVideoRef.current.srcObject = remoteStream;
              setConnectionStatus('connected');
            });
            const conn = peer.connect(roomCode.toLowerCase());
            dataConnectionRef.current = conn;
            conn.on('open', () => setConnectionStatus('connected'));
            conn.on('data', (data) => {
              if (data.type === 'message') {
                setMessages(prev => [...prev, { text: data.text, sender: 'friend', time: new Date() }]);
                if (!showChat) setUnreadMessages(prev => prev + 1);
              }
            });
          };

          const copyRoomCode = () => {
            const code = myRoomCode || (peerId ? peerId.substring(0, 8).toUpperCase() : '');
            setMessageInput(`Join my video chat! Code: ${code} üíï`);
            alert('Code copied to message! Now you can add more text and send! ‚ú®');
          };

          const sendMessage = () => {
            if (!messageInput.trim()) return;
            const newMessage = { text: messageInput, sender: 'me', time: new Date() };
            setMessages(prev => [...prev, newMessage]);
            if (dataConnectionRef.current && dataConnectionRef.current.open) {
              dataConnectionRef.current.send({ type: 'message', text: messageInput });
            }
            setMessageInput('');
          };

          const toggleVideo = () => {
            if (localStream) {
              const videoTrack = localStream.getVideoTracks()[0];
              videoTrack.enabled = !videoTrack.enabled;
              setIsVideoOn(videoTrack.enabled);
            }
          };

          const toggleAudio = () => {
            if (localStream) {
              const audioTrack = localStream.getAudioTracks()[0];
              audioTrack.enabled = !audioTrack.enabled;
              setIsAudioOn(audioTrack.enabled);
            }
          };

          const toggleChat = () => { setShowChat(!showChat); if (!showChat) setUnreadMessages(0); };

          const endCall = () => {
            if (call) call.close();
            if (dataConnectionRef.current) dataConnectionRef.current.close();
            setIsInCall(false);
            setMyRoomCode('');
            setRoomCode('');
            setMessages([]);
            setConnectionStatus('disconnected');
            setShowChat(false);
            setUnreadMessages(0);
          };

          return (
            <div className="min-h-screen bg-gradient-to-br from-pink-200 via-purple-200 to-blue-200 p-4">
              <div className="text-center mb-6">
                <h1 className="text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-pink-500 to-purple-500">Girls' Video Chat üíï</h1>
                <p className="text-purple-600 font-semibold">Chat with your besties! ‚ú®</p>
              </div>
              {!isInCall ? (
                <div className="max-w-md mx-auto">
                  <div className="bg-white/90 backdrop-blur rounded-3xl shadow-2xl p-8 border-4 border-pink-300">
                    <div className="mb-6">
                      <label className="block text-purple-600 font-bold mb-2 text-lg">Your Name üíï</label>
                      <input type="text" value={username} onChange={(e) => setUsername(e.target.value)} placeholder="Enter your name..." className="w-full px-4 py-3 rounded-2xl border-2 border-pink-300 focus:border-purple-400 outline-none text-lg" />
                    </div>
                    <div className="space-y-4">
                      <button onClick={createRoom} className="w-full bg-gradient-to-r from-pink-400 to-purple-400 hover:from-pink-500 hover:to-purple-500 text-white font-bold py-4 rounded-2xl shadow-lg transform hover:scale-105 transition-all flex items-center justify-center gap-2">
                        <Video size={24} />Create Room
                      </button>
                      <div className="text-center text-purple-500 font-semibold">OR</div>
                      <button onClick={() => setShowJoinRoom(!showJoinRoom)} className="w-full bg-gradient-to-r from-blue-400 to-teal-400 hover:from-blue-500 hover:to-teal-500 text-white font-bold py-4 rounded-2xl shadow-lg transform hover:scale-105 transition-all flex items-center justify-center gap-2">
                        <Phone size={24} />Join Friend's Room
                      </button>
                      {showJoinRoom && (
                        <div className="mt-4 space-y-3">
                          <input type="text" value={roomCode} onChange={(e) => setRoomCode(e.target.value.toLowerCase())} placeholder="Enter room code..." className="w-full px-4 py-3 rounded-2xl border-2 border-blue-300 focus:border-teal-400 outline-none text-lg text-center font-bold" />
                          <button onClick={joinRoom} className="w-full bg-teal-500 hover:bg-teal-600 text-white font-bold py-3 rounded-2xl shadow-lg">Join Now! ‚ú®</button>
                        </div>
                      )}
                    </div>
                  </div>
                  <div className="mt-6 bg-white/90 backdrop-blur rounded-3xl shadow-xl p-4 border-4 border-purple-300">
                    <p className="text-center text-purple-600 font-bold mb-2">Camera Preview</p>
                    <video ref={localVideoRef} autoPlay muted playsInline className="w-full rounded-2xl bg-gray-900" />
                  </div>
                </div>
              ) : (
                <div className="max-w-6xl mx-auto">
                  {myRoomCode && (
                    <div className="bg-white/90 backdrop-blur rounded-2xl p-4 mb-4 border-2 border-pink-300">
                      <p className="text-purple-600 font-semibold mb-2 text-center">Share this code with your friend:</p>
                      <div className="flex items-center justify-center gap-3">
                        <p className="text-3xl font-bold text-pink-500">{myRoomCode}</p>
                        <button onClick={copyRoomCode} className="bg-purple-500 hover:bg-purple-600 text-white p-3 rounded-full shadow-lg" title="Copy code to message"><Copy size={20} /></button>
                      </div>
                      <p className="text-center text-sm text-purple-500 mt-2">
                        {connectionStatus === 'waiting' ? '‚è≥ Waiting for friend...' : ''}
                        {connectionStatus === 'connecting' ? 'üîÑ Connecting...' : ''}
                        {connectionStatus === 'connected' ? '‚úÖ Connected!' : ''}
                      </p>
                    </div>
                  )}
                  <div className="grid md:grid-cols-2 gap-4 mb-4">
                    <div className="relative bg-gradient-to-br from-purple-400 to-pink-400 rounded-3xl p-1 shadow-2xl">
                      <div className="bg-gray-900 rounded-3xl overflow-hidden relative aspect-video">
                        <video ref={remoteVideoRef} autoPlay playsInline className="w-full h-full object-cover" />
                        <div className="absolute top-4 left-4 bg-pink-500/90 px-4 py-2 rounded-full"><p className="text-white font-bold">Friend üëØ‚Äç‚ôÄÔ∏è</p></div>
                        {connectionStatus !== 'connected' && (
                          <div className="absolute inset-0 flex items-center justify-center text-white text-xl font-bold bg-gray-900/50">
                            {connectionStatus === 'waiting' ? 'Waiting for friend... üí´' : ''}
                            {connectionStatus === 'connecting' ? 'Connecting... üîÑ' : ''}
                            {connectionStatus === 'disconnected' ? 'Disconnected üò¢' : ''}
                          </div>
                        )}
                      </div>
                    </div>
                    <div className="relative bg-gradient-to-br from-blue-400 to-teal-400 rounded-3xl p-1 shadow-2xl">
                      <div className="bg-gray-900 rounded-3xl overflow-hidden relative aspect-video">
                        <video ref={localVideoRef} autoPlay muted playsInline className="w-full h-full object-cover" />
                        <div className="absolute top-4 left-4 bg-teal-500/90 px-4 py-2 rounded-full"><p className="text-white font-bold">{username} (You) üíñ</p></div>
                      </div>
                    </div>
                  </div>
                  <div className="bg-white/90 backdrop-blur rounded-3xl p-6 border-4 border-purple-300 mb-4">
                    <div className="flex justify-center items-center gap-4 flex-wrap">
                      <button onClick={toggleVideo} className={`p-4 rounded-full shadow-lg transform hover:scale-110 transition-all ${isVideoOn ? 'bg-gradient-to-r from-purple-400 to-pink-400 text-white' : 'bg-gray-300 text-gray-600'}`}>
                        {isVideoOn ? <Video size={28} /> : <VideoOff size={28} />}
                      </button>
                      <button onClick={toggleAudio} className={`p-4 rounded-full shadow-lg transform hover:scale-110 transition-all ${isAudioOn ? 'bg-gradient-to-r from-blue-400 to-teal-400 text-white' : 'bg-gray-300 text-gray-600'}`}>
                        {isAudioOn ? <Mic size={28} /> : <MicOff size={28} />}
                      </button>
                      <button onClick={toggleChat} className="relative p-4 rounded-full bg-gradient-to-r from-pink-400 to-purple-400 text-white shadow-lg transform hover:scale-110 transition-all">
                        <MessageCircle size={28} />
                        {unreadMessages > 0 && <span className="absolute -top-1 -right-1 bg-red-500 text-white text-xs font-bold rounded-full w-6 h-6 flex items-center justify-center">{unreadMessages}</span>}
                      </button>
                      <button onClick={endCall} className="p-4 rounded-full bg-gradient-to-r from-red-400 to-pink-500 text-white shadow-lg transform hover:scale-110 transition-all"><PhoneOff size={28} /></button>
                    </div>
                  </div>
                  {showChat && (
                    <div className="bg-white/90 backdrop-blur rounded-3xl p-4 border-4 border-pink-300">
                      <div className="flex justify-between items-center mb-4">
                        <h3 className="text-xl font-bold text-purple-600">Messages üí¨</h3>
                        <button onClick={toggleChat} className="text-purple-500 hover:text-purple-700"><X size={24} /></button>
                      </div>
                      <div className="h-64 overflow-y-auto mb-4 space-y-2 bg-purple-50 rounded-2xl p-3">
                        {messages.length === 0 ? (
                          <p className="text-center text-purple-400 py-8">No messages yet! Say hi! üëã</p>
                        ) : (
                          messages.map((msg, idx) => (
                            <div key={idx} className={`flex ${msg.sender === 'me' ? 'justify-end' : 'justify-start'}`}>
                              <div className={`max-w-xs px-4 py-2 rounded-2xl ${msg.sender === 'me' ? 'bg-gradient-to-r from-pink-400 to-purple-400 text-white' : 'bg-white text-purple-600 border-2 border-purple-300'}`}>
                                <p className="font-semibold text-sm">{msg.text}</p>
                              </div>
                            </div>
                          ))
                        )}
                        <div ref={messagesEndRef} />
                      </div>
                      <div className="flex gap-2">
                        <input type="text" value={messageInput} onChange={(e) => setMessageInput(e.target.value)} onKeyPress={(e) => e.key === 'Enter' && sendMessage()} placeholder="Type a message..." className="flex-1 px-4 py-3 rounded-2xl border-2 border-pink-300 focus:border-purple-400 outline-none" />
                        <button onClick={sendMessage} className="bg-gradient-to-r from-pink-400 to-purple-400 hover:from-pink-500 hover:to-purple-500 text-white p-3 rounded-2xl shadow-lg"><Send size={24} /></button>
                      </div>
                    </div>
                  )}
                </div>
              )}
            </div>
          );
        }
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<GirlyVideoChat />);
    </script>
</body>
</html>
